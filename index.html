<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Portal - Login</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f4f9; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        h2 { margin-bottom: 1.5rem; color: #333; }
        input { width: 90%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
        button { width: 100%; padding: 12px; background-color: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; margin-top: 10px; }
        button:hover { background-color: #2980b9; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        .toggle-link { display: block; margin-top: 15px; color: #3498db; cursor: pointer; font-size: 0.9rem; }
        .error { color: red; font-size: 0.9rem; margin-top: 10px; display: none; }
        
        /* Dashboard Styles */
        #dashboard-view { display: none; max-width: 900px; width: 100%; }
        .class-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-top: 2rem; }
        .class-card { background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-decoration: none; color: #333; border: 1px solid #eee; display: flex; flex-direction: column; align-items: center; transition: 0.2s; position: relative; }
        .class-card:hover { transform: translateY(-5px); border-color: #3498db; }
        .class-card h3 { margin: 0 0 10px 0; }
        .status-badge { font-size: 0.8rem; padding: 4px 8px; border-radius: 4px; background: #eee; color: #777; margin-top: 10px; }
        .status-badge.active { background: #d4edda; color: #155724; }
        .logout-btn { background: #e74c3c; width: auto; padding: 8px 20px; float: right; }
    </style>
</head>
<body>

    <div class="container" id="login-form">
        <h2>Student Login</h2>
        <input type="email" id="login-email" placeholder="Email Address">
        <input type="password" id="login-pass" placeholder="Password">
        <button onclick="handleLogin()" id="login-btn">Login</button>
        <div class="error" id="login-error"></div>
        <span class="toggle-link" onclick="showRegister()">New here? Create Account</span>
    </div>

    <div class="container" id="register-form" style="display:none;">
        <h2>Create Account</h2>
        <input type="text" id="reg-name" placeholder="Full Name">
        <input type="email" id="reg-email" placeholder="Email Address">
        <input type="tel" id="reg-phone" placeholder="Phone Number">
        <input type="password" id="reg-pass" placeholder="Password">
        <button onclick="handleRegister()" id="reg-btn">Sign Up</button>
        <div class="error" id="reg-error"></div>
        <span class="toggle-link" onclick="showLogin()">Already have an account? Login</span>
    </div>

    <div id="dashboard-view">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin:0;">Welcome, <span id="user-name-display">Student</span></h2>
            <button class="logout-btn" onclick="handleLogout()">Logout</button>
        </div>
        <p>Select your class to view materials:</p>

        <div class="class-grid">
            <a href="class8.html" class="class-card" id="card-class8">
                <h3>Class 8</h3>
                <span class="status-badge" id="badge-class8">Check Access</span>
            </a>
            <a href="class9.html" class="class-card" id="card-class9">
                <h3>Class 9</h3>
                <span class="status-badge" id="badge-class9">Check Access</span>
            </a>
            <a href="class10.html" class="class-card" id="card-class10">
                <h3>Class 10</h3>
                <span class="status-badge" id="badge-class10">Check Access</span>
            </a>
            <a href="class11.html" class="class-card" id="card-class11">
                <h3>Class 11</h3>
                <span class="status-badge" id="badge-class11">Check Access</span>
            </a>
            <a href="class12.html" class="class-card" id="card-class12">
                <h3>Class 12</h3>
                <span class="status-badge" id="badge-class12">Check Access</span>
            </a>
        </div>
    </div>

    <script>
        // ==========================================
        // PASTE YOUR NEW DEPLOYED URL HERE
        // ==========================================
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw6H-zEYEMmDKZhPMAWsY2ROAoGopoGku2-ktgOPNv5OhswcX1_pg9Tw4Ux5jPDdLNq/exec'; 

        // UI Toggle Functions
        function showRegister() {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('register-form').style.display = 'block';
            clearErrors();
        }
        function showLogin() {
            document.getElementById('register-form').style.display = 'none';
            document.getElementById('login-form').style.display = 'block';
            clearErrors();
        }
        function clearErrors() {
            document.getElementById('login-error').style.display = 'none';
            document.getElementById('reg-error').style.display = 'none';
        }

        // Login Logic
        function handleLogin() {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            const btn = document.getElementById('login-btn');
            const errorDiv = document.getElementById('login-error');

            if(!email || !pass) {
                errorDiv.innerText = "Please fill in all fields";
                errorDiv.style.display = 'block';
                return;
            }

            btn.innerText = "Verifying...";
            btn.disabled = true;

            fetch(`${SCRIPT_URL}?action=login&email=${email}&pass=${pass}`)
            .then(res => res.json())
            .then(data => {
                btn.innerText = "Login";
                btn.disabled = false;
                
                if(data.status === 'success') {
                    // Show Dashboard
                    document.getElementById('login-form').style.display = 'none';
                    document.getElementById('dashboard-view').style.display = 'block';
                    document.getElementById('user-name-display').innerText = data.userName;
                    
                    // Update badges based on permissions from Spreadsheet
                    updateBadges(data.permissions);
                } else {
                    errorDiv.innerText = data.message;
                    errorDiv.style.display = 'block';
                }
            })
            .catch(err => {
                btn.innerText = "Login";
                btn.disabled = false;
                errorDiv.innerText = "Connection Error";
                errorDiv.style.display = 'block';
            });
        }

        // Register Logic
        function handleRegister() {
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const phone = document.getElementById('reg-phone').value;
            const pass = document.getElementById('reg-pass').value;
            const btn = document.getElementById('reg-btn');
            const errorDiv = document.getElementById('reg-error');

            if(!name || !email || !pass) {
                errorDiv.innerText = "Please fill in required fields";
                errorDiv.style.display = 'block';
                return;
            }

            btn.innerText = "Creating Account...";
            btn.disabled = true;

            fetch(`${SCRIPT_URL}?action=register&name=${name}&email=${email}&pass=${pass}&phone=${phone}`)
            .then(res => res.json())
            .then(data => {
                btn.innerText = "Sign Up";
                btn.disabled = false;
                
                if(data.status === 'success') {
                    alert("Account Created! Please Login.");
                    showLogin();
                } else {
                    errorDiv.innerText = data.message;
                    errorDiv.style.display = 'block';
                }
            });
        }

        function handleLogout() {
            location.reload(); // Simple reload to clear state
        }

        // Visual helper to show if a student has access
        function updateBadges(perms) {
            const classes = ['class8', 'class9', 'class10', 'class11', 'class12'];
            classes.forEach(cls => {
                const badge = document.getElementById('badge-' + cls);
                if (perms[cls] === true) {
                    badge.innerText = "Access Granted";
                    badge.classList.add('active');
                } else {
                    badge.innerText = "Locked (Ask Admin)";
                    badge.style.color = "#e74c3c";
                    // Optional: Disable link if you want to block access
                    // document.getElementById('card-'+cls).style.pointerEvents = "none";
                    // document.getElementById('card-'+cls).style.opacity = "0.6";
                }
            });
        }
    </script>
</body>
</html>
